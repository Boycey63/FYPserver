{"version":3,"sources":["../../src/models/textClassification.js"],"names":["express","require","router","Router","Classifier","nlp","fs","readline","nbc","ended","file","rawdata","readFileSync","parsedData","JSON","parse","one","two","three","four","five","saveTrainingReviews","instream","createReadStream","rl","createInterface","input","terminal","numberOfReviews","i","reviewData","openSync","reset","definePrepTasks","string","tokenize0","tokens","removeWords","stem","defineConfig","considerOnlyPresence","smoothingFactor","on","line","reviewString","numberofReviewsTrained","writeFileSync","consolidate","variable","exportJSON","exportData","stringify","res","json","console","log","appendFileSync","closeSync","parseInt","stars","review_id","text","learn","trim","close","saveTrainingReviewsUseful","useful","saveTestReviews","numberofReviewsforTesting","reviewToSave","runTest","positiveTest","negativeTest","numberOfline","testResults","predictedClass","predict","importJSON","trainReviewData","reviewText","starRating","post","req","body","module","exports"],"mappings":"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","file":"textClassification.js","sourcesContent":["const express = require('express');\nconst router = express.Router();\nconst Classifier = require( 'wink-naive-bayes-text-classifier' );\nconst nlp = require( 'wink-nlp-utils' );\nconst fs = require('fs');\nconst readline = require('readline');\n\nlet nbc = Classifier();\nlet ended = false;\n//Uncomment to when putting on server... Needs full path name on server\n//let file = '/var/www/thelittleguysproject.me/src/public/data/trainingData.json';\n\n//Uncomment when running on local host\nlet file = './src/public/data/trainingData.json';\nlet rawdata = fs.readFileSync(file,'utf8');\nlet parsedData = JSON.parse(rawdata);\n\n//Used to keep track of when rating classes are full\nlet one, two, three, four, five;\none= two= three= four= five=0;\n\n\n/*\n    Overall used to divide up, save and train the machine learning models using the YELP data set\n\n    The saveTrainingReviews function:\n     (1) takes in the 4 gigabyte review file\n     (2) opens up the reviewdata file\n     (3) sets up configurations for the machine learning algorithm\n     (4) reads the review file line by line and checks the star rating for that line\n     (5) saves each used line into the reviewdata file\n     (6) trains each used line into the algorithm\n     (7) once each review class has reached 350000 reviews learned the data is exported to the training file\n     (8) finally the files are closed\n */\nlet saveTrainingReviews = () => {\n    //Open big review file\n    let instream = fs.createReadStream('./src/public/data/review.json');\n\n    let rl = readline.createInterface({\n        input: instream,\n        terminal: false\n    });\n\n    // Reads big file and learns based off it ... need to create new document...\n    let numberOfReviews = 5261670;\n\n    let i = 0;\n\n    let reviewData = fs.openSync('./src/public/data/reviewdata.json', 'a');\n\n    nbc.reset();\n\n    nbc.definePrepTasks( [\n        // Simple tokenizer\n        nlp.string.tokenize0,\n        // Common Stop Words Remover\n        nlp.tokens.removeWords,\n        // Stemmer to obtain base word\n        nlp.tokens.stem\n    ] );\n\n    // Configure behavior\n    nbc.defineConfig( { considerOnlyPresence: true, smoothingFactor: 0.5 } );\n\n\n    rl.on('line', function(line) {\n        let reviewString = JSON.parse(line);\n        //438160 5261670\n        let numberofReviewsTrained = 350000;\n        if (!ended) {\n            if(i < numberOfReviews) {\n                //console.log(i);\n                if( i === 0 ) {\n                    fs.writeFileSync(reviewData, '{\"review\":\\n' + '\\t[');\n                }\n                if(one === numberofReviewsTrained && two === numberofReviewsTrained && three === numberofReviewsTrained && four === numberofReviewsTrained && five === numberofReviewsTrained ){\n                    i = numberOfReviews + 1;\n                    nbc.consolidate();\n                    let variable = nbc.exportJSON();\n                    let exportData = JSON.stringify(variable);\n                    fs.writeFileSync(file, exportData);\n                    res.json(\"Exported successfully!\");\n                    console.log(i);\n\n                    console.log(one + \" -> 1 star reviews\");\n                    console.log(two + \" -> 2 star reviews\");\n                    console.log(three + \" -> 3 star reviews\");\n                    console.log(four + \" -> 4 star reviews\");\n                    console.log(five + \" -> 5 star reviews\");\n\n                    fs.appendFileSync(reviewData, '\\n\\t]\\n}');\n                    fs.closeSync(reviewData);\n                    ended =true;\n                }\n                console.log(i);\n                if(parseInt(reviewString.stars) === 1 && one < numberofReviewsTrained){\n\n                    fs.appendFileSync(reviewData, '\\n' + '\\t\\t,{\"review_id\":'+ JSON.stringify(reviewString.review_id)+ ',\"stars\":' + JSON.stringify(reviewString.stars)+ ',\"text\":' + JSON.stringify(reviewString.text) +'}');\n                    nbc.learn(reviewString.text.trim(), reviewString.stars);\n                    one++;\n                    //console.log(\"One = \"+one);\n                }\n                if(parseInt(reviewString.stars) === 2 && two < numberofReviewsTrained){\n                    fs.appendFileSync(reviewData, '\\n' + '\\t\\t,{\"review_id\":'+ JSON.stringify(reviewString.review_id)+ ',\"stars\":' + JSON.stringify(reviewString.stars)+ ',\"text\":' + JSON.stringify(reviewString.text) +'}');\n                    nbc.learn(reviewString.text.trim(), reviewString.stars);\n                    two++;\n                    //console.log(\"Two = \"+two);\n                }\n                if(parseInt(reviewString.stars) === 3 && three < numberofReviewsTrained){\n                    fs.appendFileSync(reviewData, '\\n' + '\\t\\t,{\"review_id\":'+ JSON.stringify(reviewString.review_id)+ ',\"stars\":' + JSON.stringify(reviewString.stars)+ ',\"text\":' + JSON.stringify(reviewString.text) +'}');\n                    nbc.learn(reviewString.text.trim(), reviewString.stars);\n                    three++;\n                    //console.log(\"Three = \"+three);\n                }\n                if(parseInt(reviewString.stars) === 4 && four < numberofReviewsTrained){\n                    fs.appendFileSync(reviewData, '\\n' + '\\t\\t,{\"review_id\":'+ JSON.stringify(reviewString.review_id)+ ',\"stars\":' + JSON.stringify(reviewString.stars)+ ',\"text\":' + JSON.stringify(reviewString.text) +'}');\n                    nbc.learn(reviewString.text.trim(), reviewString.stars);\n                    four++;\n                    //console.log(\"Four = \"+four);\n                }\n                if(parseInt(reviewString.stars) === 5 && five < numberofReviewsTrained){\n                    if( i === 0 ){\n                        fs.appendFileSync(reviewData, '\\n' + '\\t\\t{\"review_id\":'+ JSON.stringify(reviewString.review_id)+ ',\"stars\":' + JSON.stringify(reviewString.stars)+ ',\"text\":' + JSON.stringify(reviewString.text) +'}');\n                        nbc.learn(reviewString.text.trim(), reviewString.stars);\n                    }else {\n                        fs.appendFileSync(reviewData, '\\n' + '\\t\\t,{\"review_id\":'+ JSON.stringify(reviewString.review_id)+ ',\"stars\":' + JSON.stringify(reviewString.stars)+ ',\"text\":' + JSON.stringify(reviewString.text) +'}');\n                        //nbc.learn(reviewString.text.trim(), reviewString.stars);\n                    }\n                    five++;\n                    //console.log(\"Five = \"+five);\n                }\n                i++;\n            }\n        }else{\n            rl.close();\n        }\n    });\n};\n\n/*\n    Same as above but only saves reviews with usefulness of over 4\n */\n\nlet saveTrainingReviewsUseful = () => {\n    //Open big review file\n    let instream = fs.createReadStream('./src/public/data/review.json');\n\n    let rl = readline.createInterface({\n        input: instream,\n        terminal: false\n    });\n\n    // Reads big file and learns based off it ... need to create new document...\n    let numberOfReviews = 5261668;\n\n    let i = 0;\n    let useful = 4;\n\n    let reviewData = fs.openSync('./src/public/data/reviewdatauseful2.json', 'a');\n\n    nbc.reset();\n\n    nbc.definePrepTasks( [\n        // Simple tokenizer\n        nlp.string.tokenize0,\n        // Common Stop Words Remover\n        nlp.tokens.removeWords,\n        // Stemmer to obtain base word\n        nlp.tokens.stem\n    ] );\n\n    // Configure behavior\n    nbc.defineConfig( { considerOnlyPresence: true, smoothingFactor: 0.5 } );\n\n\n    rl.on('line', function(line) {\n        let reviewString = JSON.parse(line);\n        //438160 5261670\n        let numberofReviewsTrained = 55000;\n\n        if( i === 0 ) {\n            fs.writeFileSync(reviewData, '{\"review\":\\n' + '\\t[');\n        }\n\n        if (!ended) {\n            if(i < numberOfReviews) {\n                if(one === numberofReviewsTrained && two === numberofReviewsTrained && three === numberofReviewsTrained && four === numberofReviewsTrained && five === numberofReviewsTrained ){\n                    nbc.consolidate();\n                    let variable = nbc.exportJSON();\n                    let exportData = JSON.stringify(variable);\n                    fs.writeFileSync(file, exportData);\n                    console.log(\"Exported successfully!\");\n                    console.log(one + \" -> 1 star reviews\");\n                    console.log(two + \" -> 2 star reviews\");\n                    console.log(three + \" -> 3 star reviews\");\n                    console.log(four + \" -> 4 star reviews\");\n                    console.log(five + \" -> 5 star reviews\");\n                    fs.appendFileSync(reviewData, '\\n\\t]\\n}');\n                    fs.closeSync(reviewData);\n                    ended =true;\n                }\n                if(parseInt(reviewString.stars) === 1 && parseInt(reviewString.useful) >= useful && one < numberofReviewsTrained){\n                    fs.appendFileSync(reviewData, '\\n' + '\\t\\t,{\"review_id\":'+ JSON.stringify(reviewString.review_id)+ ',\"stars\":' + JSON.stringify(reviewString.stars)+ ',\"text\":' + JSON.stringify(reviewString.text) + ',\"useful\":' + JSON.stringify(reviewString.useful) +'}');\n                    nbc.learn(reviewString.text.trim(), reviewString.stars);\n                    one++;\n                    //console.log(\"One = \"+one);\n                }\n                if(parseInt(reviewString.stars) === 2 && parseInt(reviewString.useful) >= useful && two < numberofReviewsTrained){\n                    fs.appendFileSync(reviewData, '\\n' + '\\t\\t,{\"review_id\":'+ JSON.stringify(reviewString.review_id)+ ',\"stars\":' + JSON.stringify(reviewString.stars)+ ',\"text\":' + JSON.stringify(reviewString.text) + ',\"useful\":' + JSON.stringify(reviewString.useful) +'}');\n                    nbc.learn(reviewString.text.trim(), reviewString.stars);\n                    two++;\n                    //console.log(\"Two = \"+two);\n                }\n                if(parseInt(reviewString.stars) === 3 && parseInt(reviewString.useful) >= useful && three < numberofReviewsTrained){\n                    fs.appendFileSync(reviewData, '\\n' + '\\t\\t,{\"review_id\":'+ JSON.stringify(reviewString.review_id)+ ',\"stars\":' + JSON.stringify(reviewString.stars)+ ',\"text\":' + JSON.stringify(reviewString.text) + ',\"useful\":' + JSON.stringify(reviewString.useful) +'}');\n                    nbc.learn(reviewString.text.trim(), reviewString.stars);\n                    three++;\n                    //console.log(\"Three = \"+three);\n                }\n                if(parseInt(reviewString.stars) === 4 && parseInt(reviewString.useful) >= useful && four < numberofReviewsTrained){\n                    fs.appendFileSync(reviewData, '\\n' + '\\t\\t,{\"review_id\":'+ JSON.stringify(reviewString.review_id)+ ',\"stars\":' + JSON.stringify(reviewString.stars)+ ',\"text\":' + JSON.stringify(reviewString.text) + ',\"useful\":' + JSON.stringify(reviewString.useful) +'}');\n                    nbc.learn(reviewString.text.trim(), reviewString.stars);\n                    four++;\n                    //console.log(\"Four = \"+four);\n                }\n                if(parseInt(reviewString.stars) === 5 && parseInt(reviewString.useful) >= useful && five < numberofReviewsTrained){\n                    if( i === 0 ){\n                        fs.appendFileSync(reviewData, '\\n' + '\\t\\t{\"review_id\":'+ JSON.stringify(reviewString.review_id)+ ',\"stars\":' + JSON.stringify(reviewString.stars)+ ',\"text\":' + JSON.stringify(reviewString.text) + ',\"useful\":' + JSON.stringify(reviewString.useful) +'}');\n                        nbc.learn(reviewString.text.trim(), reviewString.stars);\n                    }else {\n                        fs.appendFileSync(reviewData, '\\n' + '\\t\\t,{\"review_id\":'+ JSON.stringify(reviewString.review_id)+ ',\"stars\":' + JSON.stringify(reviewString.stars)+ ',\"text\":' + JSON.stringify(reviewString.text) + ',\"useful\":' + JSON.stringify(reviewString.useful) +'}');\n                        nbc.learn(reviewString.text.trim(), reviewString.stars);\n                    }\n                    five++;\n                    //console.log(\"Five = \"+five);\n                }\n                i++;\n            }\n            console.log(i);\n        }else{\n            rl.close();\n        }\n    });\n};\n\n\n/*\n    Overall used to get the the remaining unused reviews from the YELP data set\n\n    The saveTestReviews function:\n     (1) takes in the 4 gigabyte review file\n     (2) opens up the testdata file\n     (3) each line of the review file is read\n     (4) increments i until it reaches where the saveTrainingReviews function finished\n     (5) save each line once i = the above point\n     (6) the testdata file is closed once each class reaches 85000 (the minimum amount to have an even amount of review in each class)\n */\nlet saveTestReviews = () => {\n    //Open big review file\n    let instream = fs.createReadStream('./src/public/data/review.json');\n\n    let rl = readline.createInterface({\n        input: instream,\n        terminal: false\n    });\n\n    // Reads big file and learns based off it ... need to create new document...\n    let numberOfReviews = 5261669;\n    let i = 0;\n\n    let reviewData = fs.openSync('./src/public/data/testdata.json', 'a');\n\n    rl.on('line', function(line) {\n        let reviewString = JSON.parse(line);\n        //438160 5261670\n        let numberofReviewsforTesting = 4194867;\n        let reviewToSave = 85000;\n\n        if (!ended) {\n            if(i < numberOfReviews) {\n                console.log(i);\n                if(i >= numberofReviewsforTesting) {\n                    if(one === reviewToSave && two === reviewToSave && three === reviewToSave && four === reviewToSave && five === reviewToSave ){\n                        i = numberOfReviews + 1;\n                        console.log(one + \" -> 1 star reviews\");\n                        console.log(two + \" -> 2 star reviews\");\n                        console.log(three + \" -> 3 star reviews\");\n                        console.log(four + \" -> 4 star reviews\");\n                        console.log(five + \" -> 5 star reviews\");\n\n                        fs.closeSync(reviewData);\n                        ended =true;\n                    }\n\n                    if (parseInt(reviewString.stars) === 1 && one < reviewToSave) {\n                        fs.appendFileSync(reviewData,'\\n' + '{\"stars\":' + JSON.stringify(reviewString.stars)+ ',\"text\":' + JSON.stringify(reviewString.text) +'}');\n                        one++;\n                        //console.log(\"One = \"+one);\n                    }\n                    if (parseInt(reviewString.stars) === 2 && two < reviewToSave) {\n                        fs.appendFileSync(reviewData,'\\n' + '{\"stars\":' + JSON.stringify(reviewString.stars)+ ',\"text\":' + JSON.stringify(reviewString.text) +'}');\n                        two++;\n                        //console.log(\"Two = \"+two);\n                    }\n                    if (parseInt(reviewString.stars) === 3 && three < reviewToSave) {\n                        fs.appendFileSync(reviewData,'\\n' + '{\"stars\":' + JSON.stringify(reviewString.stars)+ ',\"text\":' + JSON.stringify(reviewString.text) +'}');\n                        three++;\n                        //console.log(\"Three = \"+three);\n                    }\n                    if (parseInt(reviewString.stars) === 4 && four < reviewToSave) {\n                        fs.appendFileSync(reviewData,'\\n' + '{\"stars\":' + JSON.stringify(reviewString.stars)+ ',\"text\":' + JSON.stringify(reviewString.text) +'}');\n                        four++;\n                        //console.log(\"Four = \"+four);\n                    }\n                    if (parseInt(reviewString.stars) === 5 && five < reviewToSave) {\n                        if(i === numberofReviewsforTesting) {\n                            fs.appendFileSync(reviewData, '{\"stars\":' + JSON.stringify(reviewString.stars) + ',\"text\":' + JSON.stringify(reviewString.text) + '}');\n                        }else {\n                            fs.appendFileSync(reviewData, '\\n' + '{\"stars\":' + JSON.stringify(reviewString.stars) + ',\"text\":' + JSON.stringify(reviewString.text) + '}');\n                        }\n                        five++;\n                        //console.log(\"Five = \"+five);\n                    }\n                }\n                i++;\n            }\n        }else{\n            rl.close();\n        }\n    });\n};\n/*\n    Overall used to test the remaining unused reviews against the machine learning model\n\n    The runTest function:\n    (1) opens the testdata file (remaining reviews that weren't used to train the model)\n    (2) opens the testresults file (where the results will be stored)\n    (3) reads each line of the testdata, predicts the rating, compares it to the YELP rating and increments the right variably\n    (4) saves variable values into testresults\n    (5) closes all files\n\n*/\nlet runTest = () => {\n    //Open big review file\n    let instream = fs.createReadStream('./src/public/data/testdata.json');\n\n    let rl = readline.createInterface({\n        input: instream,\n        terminal: false\n    });\n\n    let i = 0;\n    let positiveTest = 0;\n    let negativeTest = 0;\n    let numberOfline = 425000;\n    //let numberOfline = 2000;\n\n    let testResults = fs.openSync('./src/public/data/testResults3.json', 'a');\n    //let testResults = fs.openSync('./src/public/data/testResults2.json', 'a');\n\n    rl.on('line', function (line) {\n        if (!ended) {\n            let reviewString = JSON.parse(line);\n\n            console.log(i);\n            if (i < numberOfline) {\n                let predictedClass = nbc.predict(JSON.stringify(reviewString.text));\n\n                if (predictedClass === JSON.stringify(reviewString.stars)) {\n                    positiveTest++;\n                } else {\n                    negativeTest++;\n                }\n                i++;\n            }\n\n            if (i === numberOfline) {\n                fs.appendFileSync(testResults, 'Matching result scores >> ' + positiveTest);\n                fs.appendFileSync(testResults, '\\n' + 'Non Matching result scores >> ' + negativeTest);\n\n                console.log(\"Pos >> \" + positiveTest);\n                console.log(\"Neg >> \" + negativeTest);\n                ended = true;\n            }\n        } else {\n            rl.close();\n        }\n    });\n};\n\n\n//Any functions above this code are not run on website\nnbc.reset();\n\nnbc.definePrepTasks( [\n    // Simple tokenizer\n    nlp.string.tokenize0,\n    // Common Stop Words Remover\n    nlp.tokens.removeWords,\n    // Stemmer to obtain base word\n    nlp.tokens.stem,\n] );\n\n// Configure behavior\nnbc.defineConfig( { considerOnlyPresence: true, smoothingFactor: 0.5 } );\n\n//For importing the JSON\nnbc.importJSON(parsedData);\nnbc.consolidate();\n\n//runTest();\n\n//Function used to train new review data from user\nlet trainReviewData = (reviewText, starRating) =>{\n    nbc.importJSON(parsedData);\n    nbc.learn(reviewText, starRating);\n    nbc.consolidate();\n    let variable = nbc.exportJSON();\n    let exportData = JSON.stringify(variable);\n    fs.writeFileSync(file, exportData);\n    nbc.importJSON(parsedData);\n    nbc.consolidate();\n};\n\n//Predicts the income data from user\nrouter.post('/test', function(req, res) {\n    let predictedClass = nbc.predict(req.body.text);\n    trainReviewData(req.body.text, predictedClass);\n    res.json(predictedClass);\n});\n\n//Used to export the consolidated training data to a JSON file\nrouter.post('/export', function(req, res) {\n    nbc.consolidate();\n    let variable = nbc.exportJSON();\n    let exportData = JSON.stringify(variable);\n    fs.writeFileSync(file, exportData);\n    res.json(\"Exported successfully!\");\n});\n\n//Used ny admit to add a review and a star rating to learn\nrouter.post('/train', function(req, res) {\n    nbc.importJSON(parsedData);\n    nbc.learn(req.body.text, req.body.starRating);\n    nbc.consolidate();\n    let variable = nbc.exportJSON();\n    let exportData = JSON.stringify(variable);\n    fs.writeFileSync(file, exportData);\n    res.json(\"Exported successfully!\");\n});\n\nmodule.exports = router;"]}